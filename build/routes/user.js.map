{"version":3,"sources":["../../server/routes/user.js"],"names":["userRouter","express","Router","mergeParams","dotenv","config","silent","route","get","getUserId","req","res","next","email","scope","api","user","getOne","then","results","length","Object","assign","status","json","Error","message","catch","errors","global","err","post","checkAuth","body","data","save","console","log"],"mappings":"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","file":"user.js","sourcesContent":["import express from 'express'\nimport database from '../api/user'\nimport { checkAuth, getUserId } from '../middleware/auth'\nimport dotenv from 'dotenv'\nimport api from '../api/user'\n\nconst userRouter = express.Router({\n  mergeParams: true\n})\n//userRouter.use()\ndotenv.config({ silent: true })\n//const db = new database(process.env.DB)\n\n//userRouter.all('/data',checkAuth)\nuserRouter.route('/')\n.get(getUserId, (req,res,next) => {\n  const { email } = req\n  const scope = ['email','username','credit','gender','rating','language','verified']\n\n  //if(email === 'vale@gmail.com'){\n  //  db.listAll('users')\n  //  .then( users => {\n  //    res.status(200).json({users: users})\n  //  })\n  //  .catch(err => {\n  //    res.status(500).json({errors: {global: err.message}})\n  //  })\n  //}\n\n})\n\nuserRouter.route('/data')\n.get(getUserId, (req,res,next) => {\n  const { email } = req\n  const scope = ['email','gender','username','verified','credit','rating','language']\n  api.user.getOne({email}, 'users', scope)\n  .then( results => {\n    if(results.length > 0){\n      const user = Object.assign({}, results[0])\n      res.status(200).json({user})\n    } else {\n      throw new Error({message: 'User lost'})\n    }\n  })\n  .catch(err => {\n    res.status(500).json({errors: {global: err.message}})\n  })\n})\n.post(checkAuth,(req,res,next) => {\n  let { user } = req.body\n  const { email, ...data} = user\n  api.user.save({data}, email)\n  .then( err => {\n    if (err) {\n      res.status(500).json({errors: {global: err.message}})\n    } else {\n      res.status(200).json({message: 'Data saved'})\n    }\n  })\n  .then( ({email}) => {\n    api.user.getOne({email},'users',scope)\n  })\n  .then( results => {\n    if(results.length > 0){\n      user = results[0]\n      res.status(200).json({user})\n    }\n  })\n  .catch(err => {\n    console.log(err.message)\n  })\n})\n\nexport default userRouter\n"]}