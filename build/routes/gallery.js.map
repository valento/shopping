{"version":3,"sources":["../../server/routes/gallery.js"],"names":["galleryRouter","express","Router","mergeParams","use","bodyParser","json","get","getPermis","req","res","next","params","table","level","group","gr","console","log","permis","scope","listapi","list","getList","c_group","then","results","length","status","Error","message","catch","errors","global","err","getUserId","id","socapi","getSocial","resource_id","data","liked","viewed","shared","ordered","interested","forEach","Object","keys","entry","e","email","c_permis","post","body","user_id","uid","addSocial","success"],"mappings":";;;;;;AAAA;;;;AACA;;;;AACA;;;;AACA;;;;AACA;;AACA;;;;;;AAEA,IAAMA,gBAAgBC,kBAAQC,MAAR,CAAe;AACnCC,eAAa;AADsB,CAAf,CAAtB;AAGAH,cAAcI,GAAd,CAAkBC,qBAAWC,IAAX,EAAlB;;AAEA;AACA;AACA;AACA;;AAEAN,cAAcO,GAAd,CAAkB,uBAAlB,EAA2CC,eAA3C,EAAsD,UAACC,GAAD,EAAKC,GAAL,EAASC,IAAT,EAAkB;AAAC;AAAD,oBAC9CF,IAAIG,MAD0C;AAAA,MAC9DC,KAD8D,eAC9DA,KAD8D;AAAA,MACxDC,KADwD,eACxDA,KADwD;AAAA,MAE9DC,KAF8D,GAEpDN,GAFoD,CAE9DM,KAF8D;;AAGtE,MAAIC,KAAMD,QAAQ,CAAT,GAAc,CAAd,GAAkBA,KAA3B;AACAE,UAAQC,GAAR,CAAYF,EAAZ;AACA,MAAIG,eAAJ;AACA,UAAOJ,KAAP;AACE,SAAK,EAAL;AACEI,eAAS,GAAT;AACF;AACA,SAAK,CAAL;AACEA,eAAS,GAAT;AACF;AACA;AACA,SAAK,CAAL;AACEA,eAAS,GAAT;AACF;AACA;AACAA,eAAS,GAAT;AAZF;AAcA;AACA,MAAMC,QAAQ,CAAC,KAAD,EAAO,MAAP,EAAc,YAAd,EAA2B,OAA3B,CAAd;AACAC,kBAAQC,IAAR,CAAaC,OAAb,CAAqB,EAACC,SAASR,EAAV,EAArB,EAAoCH,KAApC,EAA2CO,KAA3C,EACCK,IADD,CACO,mBAAW;AAChB,QAAGC,QAAQC,MAAR,GAAiB,CAApB,EAAsB;AACpBjB,UAAIkB,MAAJ,CAAW,GAAX,EAAgBtB,IAAhB,CAAqBoB,OAArB;AACD,KAFD,MAEO;AACL,YAAM,IAAIG,KAAJ,CAAU,EAACC,SAAS,WAAV,EAAV,CAAN;AACD;AACF,GAPD,EAQCC,KARD,CAQQ,eAAO;AAACrB,QAAIkB,MAAJ,CAAW,GAAX,EAAgBtB,IAAhB,CAAqB,EAAC0B,QAAQ,EAACC,QAAQC,IAAIJ,OAAb,EAAT,EAArB;AAAsD,GARtE;AASD,CA/BD;;AAiCA9B,cAAcO,GAAd,CAAkB,aAAlB,EAAiC4B,eAAjC,EAA4C,UAAC1B,GAAD,EAAKC,GAAL,EAASC,IAAT,EAAkB;AAAA,qBACvCF,IAAIG,MADmC;AAAA,MACpDC,KADoD,gBACpDA,KADoD;AAAA,MAC9CuB,EAD8C,gBAC9CA,EAD8C;;AAE5D,MAAMhB,QAAQ,CAAC,OAAD,EAAS,QAAT,EAAkB,YAAlB,EAA+B,SAA/B,EAAyC,QAAzC,CAAd;AACAiB,mBAAOC,SAAP,CAAiB,EAACC,aAAaH,EAAd,EAAjB,EAAoCvB,KAApC,EAA2CO,KAA3C,EACCK,IADD,CACO,mBAAW;AAChB,QAAIe,OAAO;AACTC,aAAO,IADE;AAETC,cAAQ,IAFC;AAGTC,cAAQ,CAHC;AAITC,eAAS,CAJA;AAKTC,kBAAY;AALH,KAAX;AAOA,QAAGnB,QAAQC,MAAR,GAAiB,CAApB,EAAsB;AACpBD,cAAQoB,OAAR,CAAiB,iBAAS;AACxBC,eAAOC,IAAP,CAAYC,KAAZ,EAAmBH,OAAnB,CAA4B,aAAK;AAC/B,cAAGG,MAAMC,CAAN,MAAa,IAAhB,EAAsB,OAAOV,KAAKU,CAAL,KAAW,CAAlB;AACvB,SAFD;AAGD,OAJD;AAKAxC,UAAIkB,MAAJ,CAAW,GAAX,EAAgBtB,IAAhB,CAAqBkC,IAArB;AACD,KAPD,MAOO;AACL,YAAM,IAAIX,KAAJ,CAAU,EAACC,SAAS,cAAV,EAAV,CAAN;AACD;AACF,GAnBD,EAoBCC,KApBD,CAoBQ,eAAO;AAAErB,QAAIkB,MAAJ,CAAW,GAAX,EAAgBtB,IAAhB,CAAqB,EAAC0B,QAAQ,EAACC,QAAQC,IAAIJ,OAAb,EAAT,EAArB;AAAsD,GApBvE;AAqBD,CAxBD;;AA0BA9B,cAAcO,GAAd,CAAkB,SAAlB,EAA6B4B,eAA7B,EAAwC,UAAC1B,GAAD,EAAKC,GAAL,EAASC,IAAT,EAAkB;AAAA,MAChDE,KADgD,GACtCJ,IAAIG,MADkC,CAChDC,KADgD;AAAA,MAEhDsC,KAFgD,GAEtC1C,GAFsC,CAEhD0C,KAFgD;;AAGxD,MAAM/B,QAAQ,CAAC,KAAD,EAAO,MAAP,EAAc,YAAd,EAA2B,OAA3B,CAAd;AACAC,kBAAQC,IAAR,CAAaC,OAAb,CAAqB,EAAC6B,UAAU,GAAX,EAArB,EAAsCvC,KAAtC,EAA6CO,KAA7C,EACCK,IADD,CACO,mBAAW;AAChB,QAAGC,QAAQC,MAAR,GAAiB,CAApB,EAAsB;AACpBjB,UAAIkB,MAAJ,CAAW,GAAX,EAAgBtB,IAAhB,CAAqBoB,OAArB;AACD,KAFD,MAEO;AACL,YAAM,IAAIG,KAAJ,CAAU,EAACC,SAAS,cAAV,EAAV,CAAN;AACD;AACF,GAPD,EAQCC,KARD,CAQQ,eAAO;AAAErB,QAAIkB,MAAJ,CAAW,GAAX,EAAgBtB,IAAhB,CAAqB,EAAC0B,QAAQ,EAACC,QAAQC,IAAIJ,OAAb,EAAT,EAArB;AAAsD,GARvE;AASD,CAbD;AAcA9B,cAAcqD,IAAd,CAAmB,SAAnB,EAA8BlB,eAA9B,EAAyC,UAAC1B,GAAD,EAAKC,GAAL,EAASC,IAAT,EAAkB;AAC3DM,UAAQC,GAAR,CAAYT,IAAI6C,IAAhB;AAD2D,MAEjDd,IAFiD,GAExC/B,IAAI6C,IAFoC,CAEjDd,IAFiD;;AAGzDA,OAAKe,OAAL,GAAe9C,IAAI+C,GAAnB;AACAnB,mBAAOoB,SAAP,CAAiB,EAAEjB,UAAF,EAAjB,EAA0B/B,IAAIG,MAAJ,CAAWC,KAArC,EAA4CY,IAA5C,CAAkD,mBAAW;AAC3Df,QAAIkB,MAAJ,CAAW,GAAX,EAAgBtB,IAAhB,CAAqB,EAACoD,SAAQ,IAAT,EAArB;AACD,GAFD,EAGC3B,KAHD,CAGO;AAAA,WAAOrB,IAAIkB,MAAJ,CAAW,GAAX,CAAP;AAAA,GAHP;AAID,CARD;;kBAUe5B,a","file":"gallery.js","sourcesContent":["import express from 'express'\nimport bodyParser from 'body-parser'\nimport listapi from '../api/lists'\nimport socapi from '../api/social'\nimport { checkAuth, checkAccess, getUserId, getPermis } from '../middleware/auth'\nimport dotenv from 'dotenv'\n\nconst galleryRouter = express.Router({\n  mergeParams: true\n})\ngalleryRouter.use(bodyParser.json())\n\n//galleryRouter.get('/:table/:gender/:cat', (req,res,next) => {\n//  const { table,gender,cat } = req.params\n//  api.mann.getList( { gender,cat }, table, '*').then( rows => console.log(rows))\n//})\n\ngalleryRouter.get('/access/:table/:level', getPermis, (req,res,next) => {//checkAccess,\n  const { table,level } = req.params\n  const { group } = req\n  let gr = (group < 8) ? 8 : group\n  console.log(gr)\n  let permis\n  switch(group){\n    case 16 :\n      permis = 480\n    break\n    case 8 :\n      permis = 480\n    break\n    break\n    case 4 :\n      permis = 480\n    break\n    default :\n    permis = 500\n  }\n  //if()\n  const scope = ['uid','name','created_at','price']\n  listapi.list.getList({c_group: gr}, table, scope)\n  .then( results => {\n    if(results.length > 0){\n      res.status(200).json(results)\n    } else {\n      throw new Error({message: 'User lost'})\n    }\n  })\n  .catch( err => {res.status(500).json({errors: {global: err.message}})})\n})\n\ngalleryRouter.get('/:table/:id', getUserId, (req,res,next) => {\n  const { table,id } = req.params\n  const scope = ['liked','viewed','interested','ordered','shared']\n  socapi.getSocial({resource_id: id}, table, scope)\n  .then( results => {\n    let data = {\n      liked: 1080,\n      viewed: 2210,\n      shared: 0,\n      ordered: 0,\n      interested: 0\n    }\n    if(results.length > 0){\n      results.forEach( entry => {\n        Object.keys(entry).forEach( e => {\n          if(entry[e] !== null) return data[e] += 1\n        })\n      })\n      res.status(200).json(data)\n    } else {\n      throw new Error({message: 'No resources'})\n    }\n  })\n  .catch( err => { res.status(500).json({errors: {global: err.message}})})\n})\n\ngalleryRouter.get('/:table', getUserId, (req,res,next) => {\n  const { table } = req.params\n  const { email } = req\n  const scope = ['uid','name','created_at','price']\n  listapi.list.getList({c_permis: 500}, table, scope)\n  .then( results => {\n    if(results.length > 0){\n      res.status(200).json(results)\n    } else {\n      throw new Error({message: 'No resources'})\n    }\n  })\n  .catch( err => { res.status(500).json({errors: {global: err.message}})})\n})\ngalleryRouter.post('/:table', getUserId, (req,res,next) => {\nconsole.log(req.body)\n  const { data } = req.body\n  data.user_id = req.uid\n  socapi.addSocial({ data },req.params.table).then( results => {\n    res.status(200).json({success:true})\n  })\n  .catch(err => res.status(500))\n})\n\nexport default galleryRouter\n"]}