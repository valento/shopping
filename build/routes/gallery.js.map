{"version":3,"sources":["../../server/routes/gallery.js"],"names":["galleryRouter","express","Router","mergeParams","use","bodyParser","json","get","getPermis","req","res","next","table","params","group","gr","console","log","permis","scope","api","list","getList","c_group","then","results","length","status","Error","message","catch","errors","global","err","getUserId","email","c_permis"],"mappings":";;;;;;AAAA;;;;AACA;;;;AACA;;;;AACA;;AACA;;;;;;AAEA,IAAMA,gBAAgBC,kBAAQC,MAAR,CAAe;AACnCC,eAAa;AADsB,CAAf,CAAtB;AAGAH,cAAcI,GAAd,CAAkBC,qBAAWC,IAAX,EAAlB;;AAEA;AACA;AACA;AACA;;AAEAN,cAAcO,GAAd,CAAkB,gBAAlB,EAAoCC,eAApC,EAA+C,UAACC,GAAD,EAAKC,GAAL,EAASC,IAAT,EAAkB;AAAC;AAAD,MACvDC,KADuD,GAC7CH,IAAII,MADyC,CACvDD,KADuD;AAAA,MAEvDE,KAFuD,GAE7CL,GAF6C,CAEvDK,KAFuD;;AAG/D,MAAIC,KAAMD,QAAQ,CAAT,GAAc,CAAd,GAAkBA,KAA3B;AACAE,UAAQC,GAAR,CAAYF,EAAZ;AACA,MAAIG,eAAJ;AACA,UAAOJ,KAAP;AACE,SAAK,EAAL;AACEI,eAAS,GAAT;AACF;AACA,SAAK,CAAL;AACEA,eAAS,GAAT;AACF;AACA;AACA,SAAK,CAAL;AACEA,eAAS,GAAT;AACF;AACA;AACAA,eAAS,GAAT;AAZF;AAcA;AACA,MAAMC,QAAQ,CAAC,KAAD,EAAO,MAAP,EAAc,YAAd,EAA2B,OAA3B,CAAd;AACAC,kBAAIC,IAAJ,CAASC,OAAT,CAAiB,EAACC,SAASR,EAAV,EAAjB,EAAgCH,KAAhC,EAAuCO,KAAvC,EACCK,IADD,CACO,mBAAW;AAChB,QAAGC,QAAQC,MAAR,GAAiB,CAApB,EAAsB;AACpBhB,UAAIiB,MAAJ,CAAW,GAAX,EAAgBrB,IAAhB,CAAqBmB,OAArB;AACD,KAFD,MAEO;AACL,YAAM,IAAIG,KAAJ,CAAU,EAACC,SAAS,WAAV,EAAV,CAAN;AACD;AACF,GAPD,EAQCC,KARD,CAQQ,eAAO;AAACpB,QAAIiB,MAAJ,CAAW,GAAX,EAAgBrB,IAAhB,CAAqB,EAACyB,QAAQ,EAACC,QAAQC,IAAIJ,OAAb,EAAT,EAArB;AAAsD,GARtE;AASD,CA/BD;;AAiCA7B,cAAcO,GAAd,CAAkB,SAAlB,EAA6B2B,eAA7B,EAAwC,UAACzB,GAAD,EAAKC,GAAL,EAASC,IAAT,EAAkB;AAAA,MAChDC,KADgD,GACtCH,IAAII,MADkC,CAChDD,KADgD;AAAA,MAEhDuB,KAFgD,GAEtC1B,GAFsC,CAEhD0B,KAFgD;;AAGxD,MAAMhB,QAAQ,CAAC,KAAD,EAAO,MAAP,EAAc,YAAd,EAA2B,OAA3B,CAAd;AACAC,kBAAIC,IAAJ,CAASC,OAAT,CAAiB,EAACc,UAAU,GAAX,EAAjB,EAAkCxB,KAAlC,EAAyCO,KAAzC,EACCK,IADD,CACO,mBAAW;AAChB,QAAGC,QAAQC,MAAR,GAAiB,CAApB,EAAsB;AACpBhB,UAAIiB,MAAJ,CAAW,GAAX,EAAgBrB,IAAhB,CAAqBmB,OAArB;AACD,KAFD,MAEO;AACL,YAAM,IAAIG,KAAJ,CAAU,EAACC,SAAS,WAAV,EAAV,CAAN;AACD;AACF,GAPD,EAQCC,KARD,CAQQ,eAAO;AAAEpB,QAAIiB,MAAJ,CAAW,GAAX,EAAgBrB,IAAhB,CAAqB,EAACyB,QAAQ,EAACC,QAAQC,IAAIJ,OAAb,EAAT,EAArB;AAAsD,GARvE;AASD,CAbD;;kBAee7B,a","file":"gallery.js","sourcesContent":["import express from 'express'\nimport bodyParser from 'body-parser'\nimport api from '../api/lists'\nimport { checkAuth, checkAccess, getUserId, getPermis } from '../middleware/auth'\nimport dotenv from 'dotenv'\n\nconst galleryRouter = express.Router({\n  mergeParams: true\n})\ngalleryRouter.use(bodyParser.json())\n\n//galleryRouter.get('/:table/:gender/:cat', (req,res,next) => {\n//  const { table,gender,cat } = req.params\n//  api.mann.getList( { gender,cat }, table, '*').then( rows => console.log(rows))\n//})\n\ngalleryRouter.get('/access/:table', getPermis, (req,res,next) => {//checkAccess,\n  const { table } = req.params\n  const { group } = req\n  let gr = (group < 8) ? 8 : group\n  console.log(gr)\n  let permis\n  switch(group){\n    case 16 :\n      permis = 480\n    break\n    case 8 :\n      permis = 480\n    break\n    break\n    case 4 :\n      permis = 480\n    break\n    default :\n    permis = 500\n  }\n  //if()\n  const scope = ['uid','name','created_at','price']\n  api.list.getList({c_group: gr}, table, scope)\n  .then( results => {\n    if(results.length > 0){\n      res.status(200).json(results)\n    } else {\n      throw new Error({message: 'User lost'})\n    }\n  })\n  .catch( err => {res.status(500).json({errors: {global: err.message}})})\n})\n\ngalleryRouter.get('/:table', getUserId, (req,res,next) => {\n  const { table } = req.params\n  const { email } = req\n  const scope = ['uid','name','created_at','price']\n  api.list.getList({c_permis: 500}, table, scope)\n  .then( results => {\n    if(results.length > 0){\n      res.status(200).json(results)\n    } else {\n      throw new Error({message: 'User lost'})\n    }\n  })\n  .catch( err => { res.status(500).json({errors: {global: err.message}})})\n})\n\nexport default galleryRouter\n"]}