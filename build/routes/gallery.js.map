{"version":3,"sources":["../../server/routes/gallery.js"],"names":["galleryRouter","express","Router","mergeParams","use","bodyParser","json","get","checkAccess","req","res","next","table","params","c_permis","scope","api","list","getList","then","results","length","status","Error","message","catch","errors","global","err","getUserId","email"],"mappings":";;;;;;AAAA;;;;AACA;;;;AACA;;;;AACA;;AACA;;;;;;AAEA,IAAMA,gBAAgBC,kBAAQC,MAAR,CAAe;AACnCC,eAAa;AADsB,CAAf,CAAtB;AAGAH,cAAcI,GAAd,CAAkBC,qBAAWC,IAAX,EAAlB;;AAEA;AACA;AACA;AACA;;AAEAN,cAAcO,GAAd,CAAkB,gBAAlB,EAAoCC,iBAApC,EAAiD,UAACC,GAAD,EAAKC,GAAL,EAASC,IAAT,EAAkB;AAAA,MACzDC,KADyD,GAC/CH,IAAII,MAD2C,CACzDD,KADyD;AAAA,MAEzDE,QAFyD,GAE5CL,GAF4C,CAEzDK,QAFyD;AAGjE;;AACA,MAAMC,QAAQ,CAAC,KAAD,EAAO,MAAP,EAAc,YAAd,EAA2B,OAA3B,CAAd;AACAC,kBAAIC,IAAJ,CAASC,OAAT,CAAiB,EAACJ,UAAU,GAAX,EAAjB,EAAkCF,KAAlC,EAAyCG,KAAzC,EACCI,IADD,CACO,mBAAW;AAChB,QAAGC,QAAQC,MAAR,GAAiB,CAApB,EAAsB;AACpBX,UAAIY,MAAJ,CAAW,GAAX,EAAgBhB,IAAhB,CAAqBc,OAArB;AACD,KAFD,MAEO;AACL,YAAM,IAAIG,KAAJ,CAAU,EAACC,SAAS,WAAV,EAAV,CAAN;AACD;AACF,GAPD,EAQCC,KARD,CAQQ,eAAO;AAACf,QAAIY,MAAJ,CAAW,GAAX,EAAgBhB,IAAhB,CAAqB,EAACoB,QAAQ,EAACC,QAAQC,IAAIJ,OAAb,EAAT,EAArB;AAAsD,GARtE;AASD,CAdD;;AAgBAxB,cAAcO,GAAd,CAAkB,SAAlB,EAA6BsB,eAA7B,EAAwC,UAACpB,GAAD,EAAKC,GAAL,EAASC,IAAT,EAAkB;AAAA,MAChDC,KADgD,GACtCH,IAAII,MADkC,CAChDD,KADgD;AAAA,MAEhDkB,KAFgD,GAEtCrB,GAFsC,CAEhDqB,KAFgD;;AAGxD,MAAMf,QAAQ,CAAC,KAAD,EAAO,MAAP,EAAc,YAAd,EAA2B,OAA3B,CAAd;AACAC,kBAAIC,IAAJ,CAASC,OAAT,CAAiB,EAACJ,UAAU,GAAX,EAAjB,EAAkCF,KAAlC,EAAyCG,KAAzC,EACCI,IADD,CACO,mBAAW;AAChB,QAAGC,QAAQC,MAAR,GAAiB,CAApB,EAAsB;AACpBX,UAAIY,MAAJ,CAAW,GAAX,EAAgBhB,IAAhB,CAAqBc,OAArB;AACD,KAFD,MAEO;AACL,YAAM,IAAIG,KAAJ,CAAU,EAACC,SAAS,WAAV,EAAV,CAAN;AACD;AACF,GAPD,EAQCC,KARD,CAQQ,eAAO;AAAEf,QAAIY,MAAJ,CAAW,GAAX,EAAgBhB,IAAhB,CAAqB,EAACoB,QAAQ,EAACC,QAAQC,IAAIJ,OAAb,EAAT,EAArB;AAAsD,GARvE;AASD,CAbD;;kBAeexB,a","file":"gallery.js","sourcesContent":["import express from 'express'\nimport bodyParser from 'body-parser'\nimport api from '../api/lists'\nimport { checkAuth, checkAccess, getUserId } from '../middleware/auth'\nimport dotenv from 'dotenv'\n\nconst galleryRouter = express.Router({\n  mergeParams: true\n})\ngalleryRouter.use(bodyParser.json())\n\n//galleryRouter.get('/:table/:gender/:cat', (req,res,next) => {\n//  const { table,gender,cat } = req.params\n//  api.mann.getList( { gender,cat }, table, '*').then( rows => console.log(rows))\n//})\n\ngalleryRouter.get('/access/:table', checkAccess, (req,res,next) => {\n  const { table } = req.params\n  const { c_permis } = req\n  //if()\n  const scope = ['uid','name','created_at','price']\n  api.list.getList({c_permis: 500}, table, scope)\n  .then( results => {\n    if(results.length > 0){\n      res.status(200).json(results)\n    } else {\n      throw new Error({message: 'User lost'})\n    }\n  })\n  .catch( err => {res.status(500).json({errors: {global: err.message}})})\n})\n\ngalleryRouter.get('/:table', getUserId, (req,res,next) => {\n  const { table } = req.params\n  const { email } = req\n  const scope = ['uid','name','created_at','price']\n  api.list.getList({c_permis: 500}, table, scope)\n  .then( results => {\n    if(results.length > 0){\n      res.status(200).json(results)\n    } else {\n      throw new Error({message: 'User lost'})\n    }\n  })\n  .catch( err => { res.status(500).json({errors: {global: err.message}})})\n})\n\nexport default galleryRouter\n"]}