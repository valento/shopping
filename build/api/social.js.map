{"version":3,"sources":["../../server/api/social.js"],"names":["config","require","options","user","get","password","database","socketPath","host","db","mysql","createConnection","addSocial","data","table","sql","act","val","uid","user_id","body","mann_id","action","concat","Object","keys","values","resource_id","Promise","resolve","reject","query","err","getSocial","resource","scope","id","results"],"mappings":";;;;;;AAAA;;;;;;;;AAEA,IAAMA,SAASC,QAAQ,cAAR,CAAf;;AAEA,IAAMC,UAAU;AACdC,QAAMH,OAAOI,GAAP,CAAW,YAAX,CADQ;AAEdC,YAAUL,OAAOI,GAAP,CAAW,gBAAX,CAFI;AAGdE,YAAU;AAHI,CAAhB;;AAMA,IAAIN,OAAOI,GAAP,CAAW,0BAAX,KAA0CJ,OAAOI,GAAP,CAAW,UAAX,MAA2B,YAAzE,EAAwF;AACtFF,UAAQK,UAAR,kBAAkCP,OAAOI,GAAP,CAAW,0BAAX,CAAlC;AACD,CAFD,MAEO;AACLF,UAAQM,IAAR,GAAe,WAAf;AACAN,UAAQI,QAAR,GAAmB,QAAnB;AACD;;AAED,IAAMG,KAAKC,gBAAMC,gBAAN,CAAuBT,OAAvB,CAAX;;kBAEe;AACbU,aAAW,qBAAoB;AAAA,QAAnBC,IAAmB,uEAAd,EAAc;AAAA,QAAVC,KAAU;;AAC7B,QAAIC,YAAJ;AAAA,QAAQC,YAAR;AAAA,QAAYC,YAAZ;AAAA,QAAgBC,YAAhB;;AAD6B,qBAEDL,KAAKA,IAFJ;AAAA,QAErBM,OAFqB,cAErBA,OAFqB;AAAA,QAEVC,IAFU;;AAG7B,QAAGN,UAAU,cAAb,EAA6B;AAAA,UACnBO,OADmB,GACGD,IADH,CACnBC,OADmB;AAAA,UACRC,MADQ,4BACGF,IADH;;AAE3BF,YAAML,KAAKQ,OAAL,CAAaE,MAAb,CAAoB,GAApB,EAAwBV,KAAKM,OAA7B,CAAN;AACAH,YAAMQ,OAAOC,IAAP,CAAYH,MAAZ,EAAoB,CAApB,CAAN;AACAL,YAAMO,OAAOE,MAAP,CAAcJ,MAAd,EAAsB,CAAtB,CAAN;AACAP,6BAAqBD,KAArB,8BAAmDE,GAAnD,mBAAmEE,GAAnE,WAA2EG,OAA3E,SAAsFF,OAAtF,SAAiGF,GAAjG,kCAAiID,GAAjI,SAAwIC,GAAxI;AACD,KAND,MAMO;AAAA,UACGU,WADH,GAC8BP,IAD9B,CACGO,WADH;AAAA,UACmBL,OADnB,4BAC8BF,IAD9B;;AAELJ,YAAMQ,OAAOC,IAAP,CAAYH,OAAZ,EAAoB,CAApB,CAAN;AACAL,YAAMO,OAAOE,MAAP,CAAcJ,OAAd,EAAsB,CAAtB,CAAN;AACAP,6BAAmBD,KAAnB,8BAAiDE,GAAjD,iBAAgEW,WAAhE,SAA+ER,OAA/E,WAA2FF,GAA3F;AACD;AACD,WAAO,IAAIW,OAAJ,CAAa,UAACC,OAAD,EAASC,MAAT,EAAoB;AACtCrB,SAAGsB,KAAH,CAAShB,GAAT,EAAc,eAAO;AACnB,YAAGiB,GAAH,EAAQ,OAAOF,OAAOE,GAAP,CAAP;AACRH;AACD,OAHD;AAID,KALM,CAAP;AAMD,GAtBY;AAuBbI,aAAW,qBAA6B;AAAA,QAA5BC,QAA4B,uEAAnB,EAAmB;AAAA,QAAhBpB,KAAgB;AAAA,QAAVqB,KAAU;;AACtC,QAAMC,KAAKZ,OAAOC,IAAP,CAAYS,QAAZ,EAAsB,CAAtB,CAAX;AACA,QAAMjB,MAAMO,OAAOE,MAAP,CAAcQ,QAAd,EAAwB,CAAxB,CAAZ;AACA,QAAMnB,kBAAgBoB,KAAhB,cAA8BrB,KAA9B,eAA6CsB,EAA7C,SAAmDnB,GAAzD;AACA,WAAO,IAAIW,OAAJ,CAAa,UAACC,OAAD,EAASC,MAAT,EAAoB;AACtCrB,SAAGsB,KAAH,CAAShB,GAAT,EAAc,UAACiB,GAAD,EAAKK,OAAL,EAAiB;AAC7B,YAAG,CAACL,GAAJ,EAAQ;AACNH,kBAAQQ,OAAR;AACD,SAFD,MAEO;AACLP,iBAAOE,GAAP;AACD;AACF,OAND;AAOD,KARM,CAAP;AASD;AApCY,C","file":"social.js","sourcesContent":["import mysql from 'mysql'\n\nconst config = require('../../config')\n\nconst options = {\n  user: config.get('MYSQL_USER'),\n  password: config.get('MYSQL_PASSWORD'),\n  database: 'aappdb'\n}\n\nif( config.get('INSTANCE_CONNECTION_NAME') && config.get('NODE_ENV') === 'production' ) {\n  options.socketPath = `/cloudsql/${config.get('INSTANCE_CONNECTION_NAME')}`\n} else {\n  options.host = 'localhost'\n  options.database = 'aappdb'\n}\n\nconst db = mysql.createConnection(options)\n\nexport default {\n  addSocial: (data={}, table) => {\n    let sql,act,val,uid\n    const { user_id,...body } = data.data\n    if(table === 'mann_socials') {\n      const { mann_id,...action } = body\n      uid = data.mann_id.concat('_',data.user_id)\n      act = Object.keys(action)[0]\n      val = Object.values(action)[0]\n      sql = `INSERT INTO ${table} (uid,mann_id,user_id,${act}) VALUES('${uid}',${mann_id},${user_id},${val}) ON DUPLICATE KEY UPDATE ${act}=${val}`\n    } else {\n      const { resource_id, ...action } = body\n      act = Object.keys(action)[0]\n      val = Object.values(action)[0]\n      sql=`INSERT INTO ${table} (resource_id,user_id,${act}) VALUES(${resource_id},${user_id},'${val}')`\n    }\n    return new Promise( (resolve,reject) => {\n      db.query(sql, err => {\n        if(err) return reject(err)\n        resolve()\n      })\n    } )\n  },\n  getSocial: (resource={},table,scope) => {\n    const id = Object.keys(resource)[0]\n    const val = Object.values(resource)[0]\n    const sql = `SELECT ${scope} from ${table} WHERE ${id}=${val}`\n    return new Promise( (resolve,reject) => {\n      db.query(sql, (err,results) => {\n        if(!err){\n          resolve(results)\n        } else {\n          reject(err)\n        }\n      })\n    } )\n  }\n}\n"]}