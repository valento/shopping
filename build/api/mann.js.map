{"version":3,"sources":["../../server/api/mann.js"],"names":["config","require","options","user","get","password","database","socketPath","host","db","mysql","createConnection","mann","getList","data","table","scope","console","log","s","Object","keys","map","key","k","sql","Promise","resolve","reject","query","err","results","getListResources"],"mappings":";;;;;;AAAA;;;;;;AAEA,IAAMA,SAASC,QAAQ,cAAR,CAAf;;AAEA,IAAMC,UAAU;AACdC,QAAMH,OAAOI,GAAP,CAAW,YAAX,CADQ;AAEdC,YAAUL,OAAOI,GAAP,CAAW,gBAAX,CAFI;AAGdE,YAAU;AAHI,CAAhB;;AAMA,IAAIN,OAAOI,GAAP,CAAW,0BAAX,KAA0CJ,OAAOI,GAAP,CAAW,UAAX,MAA2B,YAAzE,EAAwF;AACtFF,UAAQK,UAAR,kBAAkCP,OAAOI,GAAP,CAAW,0BAAX,CAAlC;AACD,CAFD,MAEO;AACLF,UAAQM,IAAR,GAAe,WAAf;AACAN,UAAQI,QAAR,GAAmB,QAAnB;AACD;;AAED,IAAMG,KAAKC,gBAAMC,gBAAN,CAAuBT,OAAvB,CAAX;;kBAEe;AACbU,QAAM;AACJC,aAAS,mBAA6B;AAAA,UAA5BC,IAA4B,uEAAvB,EAAuB;AAAA,UAApBC,KAAoB;AAAA,UAAdC,KAAc,uEAAR,GAAQ;;AACpCC,cAAQC,GAAR,CAAYH,KAAZ;AACA,UAAMI,IAAIC,OAAOC,IAAP,CAAYP,IAAZ,EAAkBQ,GAAlB,CAAuB;AAAA,eAAOR,KAAKS,GAAL,CAAP;AAAA,OAAvB,CAAV;AACA,UAAMC,IAAIJ,OAAOC,IAAP,CAAYP,IAAZ,CAAV;AACA,UAAMW,kBAAgBT,KAAhB,cAA8BD,KAA9B,eAA6CS,CAA7C,QAAN;AACA,aAAO,IAAIE,OAAJ,CAAa,UAACC,OAAD,EAASC,MAAT,EAAoB;AACtCnB,WAAGoB,KAAH,CAASJ,GAAT,EAAaN,CAAb,EAAgB,UAACW,GAAD,EAAKC,OAAL,EAAiB;AAC/B;AACA,cAAGD,GAAH,EAAQ,OAAOF,MAAP;AACND,kBAAQI,OAAR;AACH,SAJD;AAKD,OANM,CAAP;AAOD,KAbG;AAcJC,sBAAkB,4BAA6B;AAAA,UAA5BlB,IAA4B,uEAAvB,EAAuB;AAAA,UAApBC,KAAoB;AAAA,UAAdC,KAAc,uEAAR,GAAQ;;AAC7CC,cAAQC,GAAR,CAAYH,KAAZ;AACA,UAAMI,IAAIC,OAAOC,IAAP,CAAYP,IAAZ,EAAkBQ,GAAlB,CAAuB;AAAA,eAAOR,KAAKS,GAAL,CAAP;AAAA,OAAvB,CAAV;AACA,UAAMC,IAAIJ,OAAOC,IAAP,CAAYP,IAAZ,CAAV;AACA,UAAMW,kBAAgBT,KAAhB,cAA8BD,KAA9B,eAA6CS,CAA7C,QAAN;AACAP,cAAQC,GAAR,CAAYO,GAAZ,EAAgBN,CAAhB;AACA,aAAO,IAAIO,OAAJ,CAAa,UAACC,OAAD,EAASC,MAAT,EAAoB;AACtCnB,WAAGoB,KAAH,CAASJ,GAAT,EAAaN,CAAb,EAAgB,UAACW,GAAD,EAAKC,OAAL,EAAiB;AAC/B;AACA,cAAGD,GAAH,EAAQ,OAAOF,MAAP;AACND,kBAAQI,OAAR;AACH,SAJD;AAKD,OANM,CAAP;AAOD;AA3BG;AADO,C","file":"mann.js","sourcesContent":["import mysql from 'mysql'\n\nconst config = require('../../config')\n\nconst options = {\n  user: config.get('MYSQL_USER'),\n  password: config.get('MYSQL_PASSWORD'),\n  database: 'aappdb'\n}\n\nif( config.get('INSTANCE_CONNECTION_NAME') && config.get('NODE_ENV') === 'production' ) {\n  options.socketPath = `/cloudsql/${config.get('INSTANCE_CONNECTION_NAME')}`\n} else {\n  options.host = 'localhost'\n  options.database = 'aappdb'\n}\n\nconst db = mysql.createConnection(options)\n\nexport default {\n  mann: {\n    getList: (data={},table,scope='*') => {\n      console.log(table)\n      const s = Object.keys(data).map( key => data[key] )\n      const k = Object.keys(data)\n      const sql = `SELECT ${scope} from ${table} where ${k}=?;`\n      return new Promise( (resolve,reject) => {\n        db.query(sql,s, (err,results) => {\n          //console.log('Mann DB: ',results)\n          if(err) return reject\n            resolve(results)\n        })\n      })\n    },\n    getListResources: (data={},table,scope='*') => {\n      console.log(table)\n      const s = Object.keys(data).map( key => data[key] )\n      const k = Object.keys(data)\n      const sql = `SELECT ${scope} from ${table} where ${k}=?;`\n      console.log(sql,s)\n      return new Promise( (resolve,reject) => {\n        db.query(sql,s, (err,results) => {\n          //console.log('Mann DB: ',results)\n          if(err) return reject\n            resolve(results)\n        })\n      })\n    }\n  }\n}\n"]}