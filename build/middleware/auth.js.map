{"version":3,"sources":["../../server/middleware/auth.js"],"names":["dotenv","config","silent","getUserId","req","res","next","token","get","decoded","jwt","decode","console","log","email","uid","getPermis","verified","verify","process","env","JWT_SECRET","api","user","getOne","then","results","membership","group","catch","err","checkAccess","password","body","credentials","usr","owner","pass","OWNER_1","PASS_1","OWNER_2","PASS_2","bcrypt","compareSync","message","status","json","errors","global","checkAuth","getAuth"],"mappings":"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","file":"auth.js","sourcesContent":["import jwt from 'jsonwebtoken'\nimport bcrypt from 'bcrypt'\nimport dotenv from 'dotenv'\n\nimport api from '../api/user'\n\ndotenv.config({silent: true})\n\nexport const getUserId = (req,res,next) => {\n  const token = req.get('Authorization')\n  const decoded = jwt.decode(token)\n  console.log('Auth Middleware: ', decoded)\n  req.email = decoded.email\n  req.uid = decoded.uid\n  next()\n}\n\nexport const getPermis = (req,res,next) => {\n  const token = req.get('Authorization')\n  const verified = jwt.verify(token, process.env.JWT_SECRET)\n  const {email} = verified\n  api.user.getOne({email},'users',['membership'])\n  .then(results => {\n    console.log(results[0].membership)\n      req.group = results[0].membership\n      next()\n    }\n  )\n  .catch(err => console.log(err))\n}\n\nexport const checkAccess = (req,res,next) => {\n  const token = req.get('Authorization')\n  const password = req.body.credentials\n  if(token){\n    try {\n      const verified = jwt.verify(token, process.env.JWT_SECRET)\n      const { email } = verified\n      console.log({email})\n\n      let usr, owner = false, pass\n      switch (email) {\n        case process.env.OWNER_1:\n          usr = '1'\n          owner = true\n          pass = process.env.PASS_1\n        break\n        case process.env.OWNER_2:\n          usr = '2'\n          owner = true\n          pass = process.env.PASS_2\n        break\n        default:\n          usr = '0'\n          owner = false\n      }\n\n    if(owner){\n        api.user.getOne({email},'users',['password','memership'])\n        .then( results => {\n          console.log(bcrypt.compareSync(pass, results[0].password))\n          req.owner = true\n          req.group = 1\n        })\n        .catch(err => console.log(err.message))\n      } else {\n        req.group = 32\n      }\n    }\n    catch(err) {\n      res.status(500).json({errors: {global: 'Invalid Credentials...'}})\n    }\n  }\n  next()\n}\n\nexport const checkAuth = (req,res,next) => {\n  const { email } = req.body.user\n  const token = req.get('Authorization')\n  if(token){\n    try {\n      const verified = jwt.verify(token, 'valeCollectionJWT')\n      if(email !== verified.email) {\n        return res.status(401).json({errors: {global: 'Unauthorized request'}})\n      } else {\n        req.user = verified\n      }\n    }\n    catch(err) {\n      return res.status(401).json({errors: {global: 'Auth failed: Invalid token'}})\n    }\n    next()\n  }\n}\n\nexport const getAuth = (req,res,next) => {\n  const token = req.get('Authorization')\n  if(token){\n    try {\n      const verified = jwt.verify(token, 'valeCollectionJWT')\n    }\n    catch(err) {\n      return res.status(401).json({errors: {global: 'Auth failed: Invalid token'}})\n    }\n    next()\n  } else {\n    return res.status(401).json({errors: {global: 'Unauthorized request'}})\n  }\n}\n"]}