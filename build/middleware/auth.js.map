{"version":3,"sources":["../../server/middleware/auth.js"],"names":["getUserId","req","res","next","token","get","decoded","jwt","decode","console","log","email","checkAccess","password","body","credentials","verified","verify","api","user","getOne","then","results","length","bcrypt","compareSync","catch","err","message","c_group","status","json","errors","global","checkAuth","getAuth"],"mappings":"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","file":"auth.js","sourcesContent":["import jwt from 'jsonwebtoken'\nimport bcrypt from 'bcrypt'\n\nimport api from '../api/user'\n\nexport const getUserId = (req,res,next) => {\n  const token = req.get('Authorization')\n  const decoded = jwt.decode(token)\n  console.log('Auth Middleware: ', decoded)\n  req.email = decoded.email\n  //req.uid = decoded.uid\n  next()\n}\n\nexport const checkAccess = (req,res,next) => {\n  const token = req.get('Authorization')\n  const password = req.body.credentials\n  if(token){\n    try {\n      const verified = jwt.verify(token, 'valeCollectionJWT')\n      const { email } = verified\n      console.log({email})\n    if(email === 'valentin.mundrov@gmail.com' || email === 'iloveaquiles09@gmail.com'){\n        api.user.getOne({email},'users',['password'])\n\n        .then( results => {\n          console.log(verified.password, results[0].password.length)\n          console.log(bcrypt.compareSync('19K0l0mbin075', results[0].password))\n\n        })\n        .catch(err => console.log(err.message))\n      } else {\n        req.c_group = 16\n      }\n    }\n    catch(err) {\n      res.status(500).json({errors: {global: 'Invalid Credentials...'}})\n    }\n  }\n  next()\n}\n\nexport const checkAuth = (req,res,next) => {\n  const { email } = req.body.user\n  const token = req.get('Authorization')\n  if(token){\n    try {\n      const verified = jwt.verify(token, 'valeCollectionJWT')\n      if(email !== verified.email) {\n        return res.status(401).json({errors: {global: 'Unauthorized request'}})\n      } else {\n        req.user = verified\n      }\n    }\n    catch(err) {\n      return res.status(401).json({errors: {global: 'Auth failed: Invalid token'}})\n    }\n    next()\n  }\n}\n\nexport const getAuth = (req,res,next) => {\n  const token = req.get('Authorization')\n  if(token){\n    try {\n      const verified = jwt.verify(token, 'valeCollectionJWT')\n    }\n    catch(err) {\n      return res.status(401).json({errors: {global: 'Auth failed: Invalid token'}})\n    }\n    next()\n  } else {\n    return res.status(401).json({errors: {global: 'Unauthorized request'}})\n  }\n}\n"]}